@model List<SistemaCapacitacion.Core.ViewModels.CursoContenidoViewModel>

@{
    ViewData["Title"] = "Detalle del Curso";
    Layout = "~/Views/_LayoutEmployee.cshtml";
}

<div class="container py-4">
    @if (!Model.Any())
    {
        <div class="alert alert-warning text-center">
            Este curso no tiene contenidos cargados correctamente.
        </div>
    }
    else
    {
        @foreach (var contenido in Model)
        {
            <div class="card shadow-lg border-0 rounded-4 mb-3">
                <div class="card-body p-4">
                    <h3 class="fw-bold mb-2">@contenido.Titulo</h3>
                    <p class="text-muted">@contenido.Descripcion</p>
                    <hr />

                    @* LOGICA ROBUSTA BASADA EN TIPO *@
                    
                   @* PRIORIDAD 1: Si dice explícitamente que es PDF (Tipo 2) O si la URL termina en .pdf *@
@if (contenido.TipoContenido == 2 || contenido.RutaContenido.EndsWith(".pdf", StringComparison.OrdinalIgnoreCase))
{
    <div style="height: 80vh; min-height: 500px;">
        <iframe src="@Url.Content(contenido.RutaContenido)" 
                class="w-100 h-100 rounded shadow-sm border"
                frameborder="0">
        </iframe>
    </div>
    <div class="mt-2 text-end">
         <a href="@Url.Content(contenido.RutaContenido)" target="_blank" class="btn btn-sm btn-outline-secondary">
            <i class="fa fa-external-link"></i> Abrir en ventana nueva
        </a>
    </div>
}
@* PRIORIDAD 2: Si es Video (Tipo 1) *@
// Agregamos la validación de extensión mp4 por si la BD falla
else if (contenido.TipoContenido == 1 || contenido.EsVideo || contenido.RutaContenido.EndsWith(".mp4", StringComparison.OrdinalIgnoreCase))
{
    <div class="ratio ratio-16x9 rounded overflow-hidden shadow-sm">
        <video class="w-100 h-100" controls controlsList="nodownload">
            <source src="@Url.Content(contenido.RutaContenido)" type="video/mp4" />
            Tu navegador no soporta el video.
        </video>
    </div>
}
@* PRIORIDAD 3: Cualquier otra cosa es un enlace *@
else 
{
    <div class="alert alert-secondary text-center p-5">
        <h4>Recurso Externo</h4>
        <a href="@contenido.RutaContenido" target="_blank" class="btn btn-primary btn-lg px-5">
            Abrir Contenido
        </a>
    </div>
}
                </div>
            </div>
        }
    }
</div>
