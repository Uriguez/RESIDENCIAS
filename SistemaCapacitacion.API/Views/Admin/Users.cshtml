@model SistemaCapacitacion.Core.ViewModels.UsersAdminViewModel
@{
    Layout = "~/Views/_LayoutAdmin.cshtml";
}

<section class="admin-main-section">
    <!-- Encabezado principal -->
    <header class="admin-header">
        <div>
            <h1 class="admin-page-title">Gestión de Usuarios</h1>
            <p class="admin-page-subtitle">
                Administra empleados y becarios del sistema Griver.
            </p>
        </div>

        <div class="admin-section-actions">
            <button class="btn btn--secondary">
                <span>⬇</span>
                <span>Exportar usuarios</span>
            </button>
            <button class="btn btn--primary">
                <span>＋</span>
                <span>Nuevo usuario</span>
            </button>
        </div>
    </header>

    <!-- Tarjetas de métricas superiores -->
    <section class="dashboard-row">
        <div class="metric-grid">
            <article class="card metric-card">
                <div class="metric-card__label">
                    <span class="metric-card__icon">👥</span>
                    <span>Total usuarios</span>
                </div>
                <div class="metric-card__value">@Model.TotalUsers</div>
                <div class="metric-card__delta">Empleados y becarios</div>
            </article>

            <article class="card metric-card">
                <div class="metric-card__label">
                    <span class="metric-card__icon">💼</span>
                    <span>Empleados</span>
                </div>
                <div class="metric-card__value">@Model.EmployeesCount</div>
                <div class="metric-card__delta">@((Model.TotalUsers > 0 ? (Model.EmployeesCount * 100 / Model.TotalUsers) : 0))% del total</div>
            </article>

            <article class="card metric-card">
                <div class="metric-card__label">
                    <span class="metric-card__icon">🎓</span>
                    <span>Becarios</span>
                </div>
                <div class="metric-card__value">@Model.InternsCount</div>
                <div class="metric-card__delta">@((Model.TotalUsers > 0 ? (Model.InternsCount * 100 / Model.TotalUsers) : 0))% del total</div>
            </article>

            <article class="card metric-card">
                <div class="metric-card__label">
                    <span class="metric-card__icon">✅</span>
                    <span>Usuarios activos</span>
                </div>
                <div class="metric-card__value">@Model.ActiveUsersCount</div>
                <div class="metric-card__delta">
                    @((Model.TotalUsers > 0 ? (Model.ActiveUsersCount * 100 / Model.TotalUsers) : 0))% del total
                </div>
            </article>

            <article class="card metric-card">
                <div class="metric-card__label">
                    <span class="metric-card__icon">📊</span>
                    <span>Progreso promedio</span>
                </div>
                <div class="metric-card__value">@Model.AverageProgress.ToString("0")%</div>
                <div class="metric-card__delta">Completion rate promedio</div>
            </article>
        </div>
    </section>

    <!-- Filtros -->
    <section class="dashboard-row">
        <article class="card table-card">
            <div class="admin-section-header">
                <div class="admin-section-title">Filtros</div>
            </div>

            <form method="get">
                <div class="filters-bar">
                    <!-- Buscador -->
                    <div style="flex: 1; min-width: 220px; display: flex; align-items: center; gap: 8px;">
                        <span>🔍</span>
                        <input type="text"
                               name="search"
                               value="@Model.Search"
                               class="form-input"
                               placeholder="Buscar usuarios..." />
                    </div>

                    <!-- Rol -->
                    <div style="display:flex; align-items:center; gap:6px; flex-wrap:wrap;">
                        <span style="font-size:0.82rem;">Rol:</span>
                        <button type="submit"
                                name="role"
                                value="all"
                                class="filter-chip @(string.IsNullOrEmpty(Model.RoleFilter) || Model.RoleFilter == "all" ? "filter-chip--active" : "")">
                            Todos
                        </button>
                        <button type="submit"
                                name="role"
                                value="admins"
                                class="filter-chip @(Model.RoleFilter == "admins" ? "filter-chip--active" : "")">
                            Admins
                        </button>
                        <button type="submit"
                                name="role"
                                value="rh"
                                class="filter-chip @(Model.RoleFilter == "rh" ? "filter-chip--active" : "")">
                            RH
                        </button>
                        <button type="submit"
                                name="role"
                                value="employees"
                                class="filter-chip @(Model.RoleFilter == "employees" ? "filter-chip--active" : "")">
                            Empleados
                        </button>
                        <button type="submit"
                                name="role"
                                value="interns"
                                class="filter-chip @(Model.RoleFilter == "interns" ? "filter-chip--active" : "")">
                            Becarios
                        </button>
                    </div>

                    <!-- Estado -->
                    <div style="display:flex; align-items:center; gap:6px; flex-wrap:wrap;">
                        <span style="font-size:0.82rem;">Estado:</span>
                        <button type="submit"
                                name="status"
                                value="all"
                                class="filter-chip @(string.IsNullOrEmpty(Model.StatusFilter) || Model.StatusFilter == "all" ? "filter-chip--active" : "")">
                            Todos
                        </button>
                        <button type="submit"
                                name="status"
                                value="active"
                                class="filter-chip @(Model.StatusFilter == "active" ? "filter-chip--active" : "")">
                            Activos
                        </button>
                        <button type="submit"
                                name="status"
                                value="inactive"
                                class="filter-chip @(Model.StatusFilter == "inactive" ? "filter-chip--active" : "")">
                            Inactivos
                        </button>
                    </div>
                </div>
            </form>
        </article>
    </section>

    <!-- Listado de usuarios -->
    <section class="dashboard-row">
        <div class="admin-section-header">
            <div class="admin-section-title">
                Usuarios (@Model.Users.Count)
            </div>
        </div>

        <div class="user-grid">
            @if (!Model.Users.Any())
            {
                <article class="card user-card">
                    <div class="user-card__header">
                        <div class="user-card__title">No hay usuarios registrados todavía.</div>
                    </div>
                    <p class="user-card__meta">
                        Cuando se agreguen empleados o becarios, aparecerán aquí.
                    </p>
                </article>
            }
            else
            {
                foreach (var u in Model.Users)
                {
                    <article class="user-card">
                        <header class="user-card__header">
                            <div style="display:flex; gap:12px; align-items:center;">
                                <div class="user-card__avatar" style="overflow:hidden; display:flex; align-items:center; justify-content:center;">
                                    @if (!string.IsNullOrEmpty(u.PhotoUrl))
                                      {
                                           <img src="@u.PhotoUrl" alt="@u.FullName" style="width:100%; height:100%; object-fit:cover;" />
                                      }
                                      else
                                        {
                                           <span>@u.Initials</span>
                                        }
                                    </div>
                                <div>
                                    <div class="user-card__title">@u.FullName</div>
                                    <div style="display:flex; gap:6px; flex-wrap:wrap; margin-top:4px;">
                                        <span class="badge badge--gray">@u.DisplayRole</span>
                                        <span class="badge badge--blue">
                                            @(string.IsNullOrWhiteSpace(u.Department) ? "Sin departamento" : u.Department)
                                        </span>
                                        <span class="badge @(u.IsActive ? "badge--green" : "badge--red")">
                                            @(u.IsActive ? "Activo" : "Inactivo")
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div>⋯</div>
                        </header>

                        <div class="user-card__meta">
                            <div style="display:flex; align-items:center; gap:6px; margin-bottom:2px;">
                                <span>📧</span>
                                <span>@u.Email</span>
                            </div>
                            <div style="display:flex; align-items:center; gap:6px; margin-bottom:2px;">
                                <span>💼</span>
                                <span>@u.Position</span>
                            </div>
                        </div>

                        <div style="margin-top:8px;">
                            <div style="display:flex; justify-content:space-between; font-size:0.78rem; color:#6b7280; margin-bottom:4px;">
                                <span>Progreso general</span>
                                <span>@u.CompletionPercent.ToString("0")%</span>
                            </div>
                            <span class="progress-bar">
                                <span class="progress-bar__fill" style="width:@u.CompletionPercent.ToString("0")%;"></span>
                            </span>

                            <div style="display:flex; justify-content:space-between; margin-top:8px; font-size:0.8rem;">
                                <div>
                                    <div class="user-card__meta">Inscritos:</div>
                                    <strong>@u.AssignedCourses cursos</strong>
                                </div>
                                <div>
                                    <div class="user-card__meta">Completados:</div>
                                    <strong>@u.CompletedCourses cursos</strong>
                                </div>
                            </div>

                            <hr style="border:none; border-top:1px solid #e5e7eb; margin:10px 0 6px;" />

                            <div style="font-size:0.8rem; color:#6b7280;">
                                <span>Última actividad: </span>
                                <strong>
                                    @(u.LastActivity.HasValue
                                                                ? u.LastActivity.Value.ToLocalTime().ToString("dd/MM/yyyy")
                                                                : "Sin actividad")
                                </strong>
                            </div>
                        </div>

                        <!-- IMPORTANTE: no se incluyen los botones Ver / Editar,
                             tal como pediste que lo haga RH en otro flujo -->
                    </article>
                }
            }
        </div>
    </section>
</section>
